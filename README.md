# iBeacon室内定位微信小程序

基于iBeacon设备的室内定位微信小程序，可以根据配置的iBeacon坐标和实时蓝牙信号强度，计算用户当前位置，并在导入的SVG地图上实时显示位置。

## 功能特点

- **导入SVG地图**：支持导入矢量SVG地图，并在小程序中显示
- **配置iBeacon**：支持配置多个iBeacon设备的信息，包括UUID、Major、Minor、坐标位置和信号功率
- **自定义信号参数**：支持配置信号传播因子n，适应不同的环境
- **实时定位**：基于三边/多边测量法，计算用户实时位置
- **位置显示**：在地图上标记用户当前位置
- **调试功能**：支持查看每个检测到的Beacon信号强度和距离估算

## 使用方法

### 1. 准备工作

- 准备一张室内平面图的SVG格式文件
- 配置好至少3个iBeacon设备，并记录好它们在平面图上的坐标位置
- 确保您的手机蓝牙功能已开启，并允许小程序使用位置权限

### 2. 配置地图

1. 打开小程序，切换到"配置管理"标签页
2. 选择"地图配置"标签
3. 点击"上传地图"按钮，上传SVG格式的室内平面图
4. 配置比例尺：设置每米在地图上对应的像素数量
5. 配置原点坐标：设置米制坐标系(0,0)点在SVG中的像素位置
6. 点击"保存配置"按钮

### 3. 配置iBeacon设备

1. 在"配置管理"页面，切换到"Beacon配置"标签
2. 点击"添加Beacon"按钮
3. 输入以下信息：
   - UUID：iBeacon设备的UUID
   - Major：iBeacon设备的Major值
   - Minor：iBeacon设备的Minor值
   - 位置X(米)：设备在地图上的X坐标(米)
   - 位置Y(米)：设备在地图上的Y坐标(米)
   - 信号功率(dBm)：设备在1米处的参考信号强度(通常是负值，如-59dBm)
4. 点击"确认"按钮保存设备配置
5. 重复上述步骤，添加至少3个iBeacon设备

### 4. 通用设置

1. 在"配置管理"页面，切换到"通用设置"标签
2. 调整信号传播因子(n)：
   - 开阔环境约为2
   - 普通室内环境约为2.5-3
   - 复杂室内环境约为3.5-4
3. 点击"保存设置"按钮

### 5. 开始定位

1. 切换到"定位地图"标签页
2. 点击"开始定位"按钮
3. 系统会开始扫描附近的iBeacon设备，并计算您的位置
4. 您的位置会以蓝色圆点标记在地图上
5. 在页面底部可以展开调试面板，查看检测到的Beacon信息

## 注意事项

- iBeacon定位精度受环境影响较大，开阔环境定位精度更高
- 需要至少3个iBeacon设备才能进行三边测量定位
- 信号传播因子n需要根据实际环境调整以获得最佳效果
- 请确保iBeacon设备的电量充足，低电量可能导致信号不稳定
- 在首次使用时，需要授予小程序使用蓝牙和位置信息的权限

## 技术实现

- 使用微信小程序原生Canvas渲染SVG地图
- 使用微信蓝牙API获取iBeacon信号
- 应用RSSI信号强度衰减模型估算距离
- 使用三边测量法和最小二乘法计算位置
- 实时滤波平滑信号抖动

## 限制与优化方向

- RSSI信号强度波动较大，可能导致位置抖动
- 环境中的墙体、设备等障碍物会影响信号传播
- 未来可考虑融合动作传感器数据，使用卡尔曼滤波优化位置估算
- 可添加信号强度热图功能，直观显示空间信号分布 